<html>
    <head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    
    </head>
    <body bgcolor="black"  style="overflow-x: hidden; overflow-y: hidden"s>
       <button style="border: 1px solid green; background-color: black; color: green"  id="gyro" onclick="DeviceMotionEvent.requestPermission()">gyro</button>
        <pre id="output" style="color: hsla(120, 100%, 25%, 1); font-size: 40px;"></pre>
         <pre id="current" style="color: hsla(120, 100%, 25%, 1); font-size: 40px;position: absolute;"></pre>
        <svg id="cont" style="font-family:'Crafty Girls'; font-size:50px;
      fill:green;position: absolute; top: 0; z-index:-100;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
   
        </svg>
        
        <script>

            var prevX = 0
            var prevY = 0

            setInterval(() => {
                //energy = 0
            }, 100)

            onmousemove = (event) => {                
                ev = {}
                ev.acceleration = {}
                const x = event.clientX / 1000
                const y = event.clientY / 1000
                ev.acceleration.x = event.clientX - prevX
                ev.acceleration.y = event.clientY - prevY
                ev.acceleration.z = 0
                prevX = x
                prevY = y
                ondevicemotion(ev)
            }

            var prev = [0,0,0]
            var energy = 0.001
            
            var energyThreshold = 0.05
            var minEnergy = 0.0
            var energyScale = 1.0
            
            ondevicemotion = (event) => {
                setInterval(() => {
                    document.getElementById("gyro").style.display = 'none'
                }, 100)
                var [x, y, z] = [event.acceleration.x, event.acceleration.y, event.acceleration.z]
                var [dx, dy, dz] = [x - prev[0], y - prev[1], z - prev[2]]
                prev = [x, y, z]
                var [x, y, z] = [dx, dy, dz]
                energy = energyScale * (dx * dx + dy * dy + dz * dz)
                if (energy > energyThreshold) {
                    energy = energyThreshold
                }
                
            
            }

            setInterval(() => {
                energy = 0
            }, 300)
        </script>
        <script src="https://unpkg.com/intersects/umd/intersects.min.js"></script>
        <script>
        var screenWidth = document.body.clientWidth - 20
        var screenHeight = document.body.clientHeight - 40

        const rate = 10

         var play = false
         var score = ":"
         var highscore = 0
         highscore = localStorage.getItem('highscore') ?? 0
         
         const svgns = "http://www.w3.org/2000/svg"
         const container = document.getElementById( 'cont' );
         container.setAttributeNS(null, "width", screenWidth)
         container.setAttributeNS(null, "height", screenHeight - 100)
         

            
            container.innerHTML = ""            
            
            const initx = 200
            const inity = 755
            const radius = 30 * screenHeight / 755
            var x = initx
            var y = inity

            var maxpos = 0
            

            const circle = document.createElementNS(svgns, 'circle');
            circle.setAttributeNS(null, 'cx', x);
            circle.setAttributeNS(null, 'cy', y);
            circle.setAttributeNS(null, 'r', radius);
            circle.setAttributeNS(null, 'style', 'fill: blue; stroke: blue; stroke-width: 1px;' );
            container.appendChild(circle);


            const console = [":"]
            const template = "_____<<<<□↵abcdefghijklmnopqrstuvwxyz===".split("")
            var set = template

            var i = 0

            const cancel2 = setInterval(() => {
                i++
                const gravity = ((6 + 5 * y / screenHeight) * screenHeight / 755) / rate
                const shift = (y - (energy * energy * 15000 * (screenHeight / 755) * (screenHeight / 755)) / rate)
                y1 = Math.max(0, Math.min(screenHeight, (shift + gravity)))
                if (y1 < 30) {
                    y1 = screenHeight
                }
                if (y1 < y) {
                    y = y1 
                } else {
                    y = y1 + gravity * (0.3 * 1000 / shift)
                }
                circle.setAttributeNS(null, 'cx', x);
                circle.setAttributeNS(null, 'cy', y); 
                const pos = ((screenHeight - y) / screenHeight)
                //score = "" + maxpos

                if (pos < 0) {
                    pos = 0
                }


                if (pos > maxpos) {
                    maxpos = pos
                }

                const cursor = Math.round(set.length * maxpos)

                const candidate = set[cursor % set.length]

                if (pos < 0.03 && candidate !== '_') {
                    if (candidate === '<') {
                        console.pop()
                    } else {
                        console.push(candidate === '□' ? ' ' : (candidate === '↵' ? "\n" : candidate))
                    }
                    maxpos = 0
                }
                if (pos < 0.03) {
                    maxpos = 0
                    roll = 5
                }



                const style  = `color: hsla(${120}, ${95}%, ${50 + 20 * y / screenHeight}%, 1); font-size: ${40 }px`

                document.getElementById("output").innerHTML = console.join("") + `<font style="${style}">${set[cursor]}</font>`
                document.getElementById("current").innerHTML = `<font style="${style}">${ set[Math.round(set.length * pos)]}</font>`
               
                document.getElementById("current").style.left = x
                document.getElementById("current").style.top = y - 40
               
                const speed = 10 / rate
                
            }, 100 / rate)
         



        </script>
    </body>
</html>