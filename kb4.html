<html>
    <head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="user-scalable=yes, minimal-ui, initial-scale=3, width=1280">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    
    </head>
    <body bgcolor="black" style="overflow-x: hidden; overflow-y: hidden">
   

    <button style="border: 1px solid green; background-color: black; color: green; z-index: 100;"  id="gyro" onclick="console.log('hello'); DeviceMotionEvent.requestPermission()">gyro</button>
    <pre id="output" style="color: hsla(120, 100%, 25%, 1); font-family: monospace Lucida Console; font-size:80px; margin:30; padding:0; line-height: 85px"></pre>
    <canvas id="preview" style="position: absolute; top: 0; z-index: -1"></canvas>
    <script>

            var prevX = 0
            var prevY = 0

            setInterval(() => {
                //energy = 0
            }, 100)

            onmousemove = (event) => {                
                ev = {}
                ev.acceleration = {}
                const x = event.clientX / 1000
                const y = event.clientY / 1000
                ev.acceleration.x = (event.clientX - prevX) / 4
                ev.acceleration.y = (event.clientY - prevY) / 4
                ev.acceleration.z = 0
                prevX = x
                prevY = y
                ondevicemotion(ev)
            }

            var prev = [0,0,0]
            var energy = 0.001
            
            var energyThreshold = 0.05
            var minEnergy = 0.0
            var energyScale = 1.0
            
            ondevicemotion = (event) => {
                setInterval(() => {
                    document.getElementById("gyro").style.display = 'none'
                }, 100)
                var [x, y, z] = [event.acceleration.x, event.acceleration.y, event.acceleration.z]
                var [dx, dy, dz] = [x - prev[0], y - prev[1], z - prev[2]]
                prev = [x, y, z]
                var [x, y, z] = [dx, dy, dz]
                energy = energyScale * (dx * dx + dy * dy + dz * dz)
                if (energy > energyThreshold) {
                    energy = energyThreshold
                }
                if (energy < 0.03) {
                    energy = 0
                }
                
            
            }

            setInterval(() => {
                energy = 0
            }, 300)
        </script>
        <script>
            let energyy = 0
            let maxenergyy = 0
            let energyyy = 0

            const data = []

            let point = undefined
            window.stream = []

            let polarity = 1

            setInterval(() => {
                if (energy > 0.00001) {
                    energyy += (energy - 0.03) / 0.01 //0.01
                    if (energyy > maxenergyy) {
                        maxenergyy = energyy
                    }
                } else {
                    energyy = Math.min(10, energyy)
                    energyy--
                    maxenergyy = Math.min(20, maxenergyy)
                    if (((maxenergyy - energyy) > 1 || maxenergyy > 10)) {
 
                        energyyy = energyyy + maxenergyy + ((maxenergyy === 0)? 0 : -6)
                        energyy = 0
                        maxenergyy = 0

                        if (energyyy < 0) {
                            energyyy = 0
                        }

                    }
                }
            }, 1)


 
            let candidate = undefined
            window.counter = 0
            window.counterThreshold = 33
            window.position = 0

            window.alphabet = ["_", "□", "↵", "<"].concat("01234567890abcdefghijklmnopqrstuvwxyz!".split(""))

            setInterval(() => {

                position = (energyyy + maxenergyy)
                let cursor = (Math.floor((energyyy + maxenergyy) / 20)) % alphabet.length

                

                if (cursor === candidate) {
                    counter ++
                    if (energy < 0.01) {
                        counter += 0.1
                    }
                } else {
                    if (candidate && cursor > candidate) {
                        cursor = Math.min(alphabet.length + 1, candidate + 1)
                    }
                    counter = 0
                }
                candidate = cursor

                if (counter > counterThreshold && candidate != 0) {
                    if (alphabet[cursor] === "□") {
                        stream.push(" ")
                    } else if (alphabet[cursor] === "↵") {
                        stream.push("\n")
                    } else if (alphabet[cursor] === "<") {
                        stream.pop()
                    } else {
                        stream.push(alphabet[cursor])
                    }
                    
                    candidate = undefined
                    energyyy = 0
                    
                }

                if (counter > counterThreshold && candidate == 0) {
                    counter = 0
                }
                
                const style = 
                    `color: hsla(${80}, ${95}%, ${20 + counter * 20 / counterThreshold}%, 1); 
                        font-size: ${80 }px; 
                        line-height: 1em;`



                document.getElementById("output").innerHTML =
                     "" 
                     + (stream.length === 0 ? "" : stream.reduce((a,b) => a + b)) 
                     + "" 
                     //+ `<font style="${style}">${alphabet[cursor]} </font>`
            }, 30)
        </script>
        <script>
            const canvas = document.getElementById("preview")
            canvas.width = document.body.clientWidth - 20
            canvas.height = document.body.clientHeight - 40
            const ctx = canvas.getContext("2d")
            

            const animate = () => {
                const out = document.getElementById("output")
                const shiftconsole = out.getBoundingClientRect().top
                const cy = shiftconsole + (stream.join("").split("\n").length - 1) * (80 + 5) + 45 + 25
                const cx = (stream.join("").substring(stream.join("").lastIndexOf("\n") + 1).length) * 48 + 5 + 30


                ctx.clearRect(0,0, 300, 300)
                ctx.font = "80px 'Lucida Console', monospace";
                
                for (let i = (candidate + 4); i >= candidate ; i--) {

                    


                    if (i === candidate) {
                        
                        ctx.fillStyle = `rgba(0,0,0,${0.5 })`
                        ctx.fillRect(0, 0, 3000, 3000)
                    } else {

                        ctx.fillStyle = `rgba(0,0,0,${0.3})`
                        ctx.fillRect(0, 0, 3000, 3000)
                    }

                    ctx.fillStyle = `hsla(${120}, ${80}%, ${40}%, ${1.0})`;
                    
                    const shifts = {
                        'l': 5,
                        '<': 5
                    }
                    
                    const shiftx = shifts[alphabet[i % alphabet.length]] ?? 0
                    ctx.fillText(alphabet[i % alphabet.length], cx + shiftx, cy)


                    
                }

                
                

                
                 
                

                requestAnimationFrame(animate)
            }
            animate()
            

        </script>
        </body>
</html>